echo "ğŸ” Running pre-commit checks..."

# Check if there are backend changes
if git diff --cached --name-only | grep -q "^backend/"; then
  echo "ğŸ“¦ Backend changes detected - running checks..."
  
  # Check Spotless formatting
  echo "ğŸ¨ Checking code formatting with Spotless..."
  cd backend && mvn spotless:check
  if [ $? -ne 0 ]; then
    echo "âŒ Spotless formatting check failed. Run 'mvn spotless:apply' to fix formatting."
    exit 1
  fi
  
  # Check compilation
  echo "ğŸ”¨ Checking compilation..."
  mvn test-compile -q
  if [ $? -ne 0 ]; then
    echo "âŒ Compilation failed. Please fix compilation errors."
    exit 1
  fi
  
  cd ..
  echo "âœ… Backend checks passed!"
fi

# Check if there are frontend changes
if git diff --cached --name-only | grep -q "^frontend/"; then
  echo "ğŸŒ Frontend changes detected - running checks..."
  
  # Check ESLint
  echo "ğŸ§¹ Running ESLint..."
  cd frontend && npm run lint
  if [ $? -ne 0 ]; then
    echo "âŒ ESLint check failed. Please fix linting errors."
    exit 1
  fi
  
  # Check TypeScript compilation
  echo "ğŸ“˜ Checking TypeScript compilation..."
  npx tsc --noEmit
  if [ $? -ne 0 ]; then
    echo "âŒ TypeScript compilation failed. Please fix type errors."
    exit 1
  fi
  
  cd ..
  echo "âœ… Frontend checks passed!"
fi

echo "ğŸ‰ All pre-commit checks passed!"
